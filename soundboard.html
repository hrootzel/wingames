<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chiptune SFX Soundboard</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 18px;
      background: #0f1117;
      color: #e7eaf0;
    }
    h1 {
      margin: 0 0 6px;
    }
    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0;
      align-items: center;
    }
    button {
      padding: 10px 12px;
      border: 0;
      border-radius: 10px;
      background: #2a3142;
      color: #e7eaf0;
      cursor: pointer;
    }
    button:hover {
      background: #39425a;
    }
    button.primary {
      background: #3b62ff;
    }
    button.primary:hover {
      background: #2f56f0;
    }
    label {
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }
    select,
    input {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #3a4256;
      background: #141827;
      color: #e7eaf0;
    }
    input[type="range"] {
      padding: 0;
    }
    .panel {
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.04);
    }
    .muted {
      color: rgba(231, 234, 240, 0.65);
    }
    code {
      color: #b7c6ff;
    }
  </style>
</head>
<body>
  <h1>Chiptune SFX Soundboard</h1>
  <div class="muted">Pick a bank, unlock audio, then press buttons to test SFX.</div>

  <div class="panel" style="margin-top: 14px;">
    <div class="row">
      <button id="unlock" class="primary">Unlock / Enable Audio</button>

      <label>
        Bank
        <select id="bank">
          <option value="PP">Puzzle Puncher</option>
          <option value="PLOP">Plop Plop</option>
          <option value="PILL">Pill Popper</option>
        </select>
      </label>

      <label>
        Master
        <input id="master" type="range" min="0" max="1" step="0.01" value="0.60">
      </label>

      <label>
        <input id="enabled" type="checkbox" checked> Enabled
      </label>
    </div>

    <div class="row">
      <label>chain <input id="chain" type="number" min="1" max="20" value="2" style="width: 76px;"></label>
      <label>cleared <input id="cleared" type="number" min="0" max="60" value="8" style="width: 76px;"></label>
      <label>viruses <input id="viruses" type="number" min="0" max="6" value="2" style="width: 76px;"></label>
      <span class="muted">(payload fields are optional; banks ignore what they do not use)</span>
    </div>

    <div class="row">
      <button data-sfx="move">move</button>
      <button data-sfx="rotate">rotate</button>
      <button data-sfx="lock">lock</button>
      <button data-sfx="clear">clear</button>
      <button data-sfx="chain">chain</button>
      <button data-sfx="gameOver">game over</button>
    </div>

    <div class="muted" style="margin-top: 10px;">
      Tip: If you do not hear anything, click <code>Unlock / Enable Audio</code> again.
    </div>
  </div>

  <script type="module">
    import { SfxEngine } from './sfx_engine.js';
    import { BANK_PUZZLEPUNCHER } from './sfx_bank_puzzle_puncher.js';
    import { BANK_PLOPPLOP } from './sfx_bank_plop_plop.js';
    import { BANK_PILLPOPPER } from './sfx_bank_pill_popper.js';

    const sfx = new SfxEngine({ master: 0.6 });

    const elUnlock = document.querySelector('#unlock');
    const elBank = document.querySelector('#bank');
    const elMaster = document.querySelector('#master');
    const elEnabled = document.querySelector('#enabled');
    const elChain = document.querySelector('#chain');
    const elCleared = document.querySelector('#cleared');
    const elViruses = document.querySelector('#viruses');

    function currentBank() {
      switch (elBank.value) {
        case 'PP':
          return BANK_PUZZLEPUNCHER;
        case 'PLOP':
          return BANK_PLOPPLOP;
        case 'PILL':
        default:
          return BANK_PILLPOPPER;
      }
    }

    function payload() {
      return {
        chain: Number(elChain.value) || 1,
        chainIndex: Number(elChain.value) || 1,
        cleared: Number(elCleared.value) || 0,
        viruses: Number(elViruses.value) || 0,
      };
    }

    elUnlock.addEventListener('click', () => {
      sfx.unlock();
    });

    elMaster.addEventListener('input', () => {
      sfx.setMaster(elMaster.value);
    });

    elEnabled.addEventListener('change', () => {
      sfx.setEnabled(elEnabled.checked);
    });

    document.querySelectorAll('button[data-sfx]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const name = btn.getAttribute('data-sfx');
        sfx.play(currentBank(), name, payload());
      });
    });

    window.addEventListener('keydown', (e) => {
      if (e.repeat) return;
      if (e.key === ' ') {
        sfx.play(currentBank(), 'lock', payload());
        e.preventDefault();
      }
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        sfx.play(currentBank(), 'move', payload());
      }
      if (e.key === 'ArrowUp') {
        sfx.play(currentBank(), 'rotate', payload());
      }
      if (e.key.toLowerCase() === 'c') {
        sfx.play(currentBank(), 'clear', payload());
      }
      if (e.key.toLowerCase() === 'x') {
        sfx.play(currentBank(), 'chain', payload());
      }
      if (e.key.toLowerCase() === 'g') {
        sfx.play(currentBank(), 'gameOver', payload());
      }
    });

    window.addEventListener('pointerdown', () => sfx.unlock(), { once: true });
  </script>
</body>
</html>
