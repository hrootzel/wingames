export const TOTAL_STAGES = 33;

export const SPEED_COUNTER_TABLE = [
  4, 10, 18, 28, 40, 54, 70, 88,
  108, 130, 154, 180, 208, 238, 270, 9999,
];

const SPEED_VALUES_BY_DIFFICULTY = {
  easy: [
    3.3, 3.55, 3.8, 4.05, 4.3, 4.55, 4.8, 5.05,
    5.3, 5.55, 5.8, 6.05, 6.3, 6.55, 6.8, 7.05,
  ],
  hard: [
    3.7, 3.95, 4.2, 4.45, 4.7, 4.95, 5.2, 5.45,
    5.7, 5.95, 6.2, 6.45, 6.7, 6.95, 7.2, 7.45,
  ],
};

export function speedValuesForDifficulty(difficulty) {
  return SPEED_VALUES_BY_DIFFICULTY[difficulty] || SPEED_VALUES_BY_DIFFICULTY.easy;
}

export function silverHitsForStage(stageNum) {
  return Math.max(1, Math.min(6, 1 + Math.floor((stageNum - 1) / 8)));
}

export function capsuleCountForStage(stageNum) {
  return Math.max(2, Math.min(8, 2 + Math.floor((stageNum - 1) / 5)));
}

// 10 columns x 8 rows. Symbols: . empty, 1-9 normal, S silver, G gold.
// Stage count follows arcade progression length (32 brick stages + final boss stage concept).
const STAGE_ROWS = [
  ['..12344321', '.123456543', '1234567654', 'S123GG321S', '8765435678', '.876545678', '..8766678.', '...88..88.'],
  ['11......11', '122....221', '1234..4321', '1235665321', 'S234GG432S', '2345665432', '3456776543', '4567887654'],
  ['...3333...', '..344443..', '.345GG543.', '3456666543', '4567777654', 'S567888765', '.678888876', '..7899987.'],
  ['1.2.3.4.5.', '.2.3.4.5.6', '3.4.5.6.7.', '.4.5.G.6.7', '5.6.G.G.7.', '.6.7.G.8.1', '7.8.1.2.3.', 'S8.1.2.3.S'],
  ['1111222211', '2222333322', '3333444433', '4444GG4444', '5555GG5555', '6666777766', '7777888877', '8888999988'],
  ['..12SS21..', '.12344321.', '1235665321', '2345GG5432', '3456GG6543', '4567777654', '.567888765', '..678998..'],
  ['1S1S1S1S1S', '2121212121', '3232323232', '434GG43434', '545GG54545', '6565656565', '7676767676', '8S8S8S8S8S'],
  ['....11....', '...1221...', '..123321..', '.123GG321.', '1234GG4321', '.234666432', '..3455543.', '...46664..'],
  ['8765434567', '7654323456', '6543212345', '5432GG2345', '4321GG1234', '3212343212', '2123454321', 'S12345678S'],
  ['1234567891', '2345678912', '3456789123', '4567GG1234', '5678GG2345', '6789123456', '7891234567', '8912345678'],
  ['SS......SS', 'S12344321S', '1234555432', '23456GG432', '34567GG543', '4567887654', '5678998765', 'SS......SS'],

  ['.99888899.', '9987667899', '9876556789', '8765GG5678', '7654GG4567', '6543333456', '5432222345', '.43211234.'],
  ['12S34S56S7', '2345656789', '3456767891', '4567GG8912', '5678GG9123', '6789912345', '7891234567', '8S9123456S'],
  ['.........1', '.......112', '.....11223', '...11GG334', '.11..GG445', '2233445566', '3344556677', 'S44556677S'],
  ['19..88..91', '2988778892', '3876666783', '4765GG5674', '5654GG4565', '6543333456', '7432222347', 'S832111238'],
  ['1111SS1111', '2222333322', '3333444433', '4444GG4444', '5555GG5555', '6666777766', '7777888877', '8888SS8888'],
  ['.1.2.3.4.5', '1.2.3.4.5.', '.2.3.4.5.6', '2.3.G.G.6.', '.3.4.G.6.7', '3.4.5.6.7.', '.4.5.6.7.8', 'S5.6.7.8.S'],
  ['..222222..', '.233333332', '2344444432', '3455GG5543', '4566GG6654', '5677777765', '.678888876', '..7899998.'],
  ['S1S2S3S4S5', '2122232425', '3233343435', '4344GG4545', '5455GG5655', '6566676765', '7677787875', 'S8S9S1S2S3'],
  ['123454321.', '2345654321', '3456765432', '4567GG6543', '5678GG7654', '6789988765', '789..98765', 'S9....876S'],
  ['....9999..', '..998877..', '.987666789', '8765GG5678', '7654GG4567', '6543333456', '.543222345', '..432112..'],

  ['98......89', '987....789', '8766..6678', '7655GG5567', '6544GG4456', '5433333345', '4322222234', 'S321111123'],
  ['1112223334', '2223334445', '3334445556', '4445GG6667', '5556GG7778', '6667778889', '7778889991', 'S88999111S'],
  ['1..2..3..4', '.2..3..4..', '..3..4..5.', '.4..G..5..', '5..G..6..7', '..6..7..8.', '.7..8..9..', 'S8..9..1.S'],
  ['..765567..', '.765666567', '7656777656', '6567GG7656', '5678GG8765', '6788998767', '.789..9878', '..89..98..'],
  ['SS111111SS', '1222222221', '2333333332', '3444GG4443', '4555GG5554', '5666666665', '6777777776', 'SS888888SS'],
  ['1S2345432S', '2123456543', '3234567654', '4345GG6545', '5456GG7656', '6567898767', '76789..987', 'S878....98'],
  ['.123SS321.', '1234566543', '2345677654', '3456GG6545', '4567GG7656', '5678888767', '6789999878', '.789....89'],
  ['9.8.7.6.5.', '.8.7.6.5.4', '7.6.5.4.3.', '.6.5.G.4.2', '5.4.G.G.3.', '.4.3.G.2.1', '3.2.1.9.8.', 'S2.1.9.8.S'],
  ['..111111..', '.122222221', '1233333321', '2344GG4432', '3455GG5543', '4566666654', '5677777765', 'S67888876S'],
  ['8765..5678', '7654..4567', '6543..3456', '5432GG2345', '4321GG1234', '3211221123', '2122332212', 'S123344321'],

  ['11S11S11S1', '2223333322', '3334444433', '4445GG5444', '5556GG6555', '6667777766', '7778888877', 'S89999998S'],
  ['.1.2S2.1..', '1.233332.1', '.23444432.', '2345GG5432', '3456GG6543', '.45666654.', '1.567776.1', '.S678876S.'],
];

if (STAGE_ROWS.length !== TOTAL_STAGES) {
  throw new Error(`Expected ${TOTAL_STAGES} stage rows, got ${STAGE_ROWS.length}`);
}

export function getStageRows(stageNum) {
  const idx = Math.max(0, Math.min(TOTAL_STAGES - 1, Math.floor(stageNum) - 1));
  return STAGE_ROWS[idx];
}
